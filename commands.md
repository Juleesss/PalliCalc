claude --dangerously-skip-permissions "You are an autonomous coding agent running inside Cursor with full write access to this repository. Your job is to **create the complete PalliCalc project from scratch**, following the PRD in \`PRD.md\` and the instructions below. You are allowed **only in the scope of the project** to create, modify, and delete files, initialize tools, and run commands as needed.\n\n## Core Product Requirements\n\n- Read \`PRD.md\` first and strictly implement that specification.\n- Build a **lean, mobile-first, offline-capable SPA** (single-page application, client-side only, no backend, no database).\n- The app is an **opioid rotation calculator** for palliative care that:\n  - Accepts one or more current opioid regimens (drug, route, dose, frequency, optional asymmetrical dosing).\n  - Converts them to **Oral Morphine Equivalent (OME)** using the factors and rules in the PRD.\n  - Sums OMEs, applies **incomplete cross-tolerance dose reduction**, and converts into a **target opioid** and divided regimen.\n  - Implements **GFR-based safety warnings** and drug-specific cautions (e.g. methadone, nalbuphine, fentanyl patches) exactly as described.\n\n## Architecture & Tech Choices\n\n- **Frontend:**\n  - Use **React with TypeScript** and a modern bundler (Vite or similar) OR a clean Vanilla TS setup with minimal tooling. Prefer React+Vite unless there is a strong reason otherwise.\n  - Single-page app, no routing requirements beyond what's needed for a clean UX.\n  - Must build to a static bundle that can be served as plain files (no server-side rendering, no backend APIs).\n- **Python / uv usage:**\n  - Create a separate Python package (e.g. \`ome_core\`) managed by **uv** for modelling and testing the pharmacological logic.\n  - Inside the repo, create a directory (e.g. \`ome_core/\`) and **initialize a uv library project** there:\n    - Run equivalent of: \`uv init --lib ome_core\` in that subdirectory.\n    - Implement pure, well-tested functions for:\n      - Converting specific drugs/routes/frequencies to OME.\n      - Summing and reducing OMEs.\n      - Converting from OME to target drug and suggested dose splitting.\n      - Applying GFR and drug-specific safety rules.\n    - Add tests (e.g. with pytest) and make it easy to run them with \`uv run pytest\`.\n  - The frontend's calculation logic should be a faithful port of the uv-tested Python logic into TypeScript (mirrored behavior).\n\n## UX / UI Requirements\n\n- Strictly follow the PRD's UX guidelines:\n  - **Card-based layout** for:\n    - Patient parameters (including GFR and warnings).\n    - Current regimen(s).\n    - Target regimen & results.\n  - **Mobile-first**, touch-friendly UI:\n    - Big, easily tappable buttons and controls.\n    - Layout that works well on phones and tablets.\n  - **Language support:**\n    - Primary UI in **Hungarian**, with an easy way to switch to **English** (it can be a simple toggle or button).\n    - Code (variable names, comments) in English is fine.\n  - Prominent **red/orange safety warnings** when:\n    - GFR < 30 ml/min.\n    - Methadone or other warned drugs are involved.\n    - Any situation described as high risk in the PRD.\n- On load, the app should **immediately show the calculator** (no login, no splash beyond a very light intro).\n\n## Data & Safety Logic\n\n- Implement the exact **OME conversion table** and special cases from \`PRD.md\`:\n  - Factors TO/FROM OME per drug/route.\n  - Special handling of **fentanyl patches (mcg/hr)** with the given 72-hour conversion table.\n  - Warnings / exclusions for **methadone**, **nalbuphine**, etc.\n- Implement the **calculation flow exactly**:\n  1. Current drug(s) → total daily dose (TDD), including support for asymmetrical dosing.\n  2. TDD × (factor TO OME) → OME per drug.\n  3. Sum all OMEs → Total Current OME.\n  4. Apply clinician-chosen **% dose reduction** (typically 25–50%).\n  5. Multiply by factor FROM OME to the target drug.\n  6. Compute **target daily dose** and intelligently suggest divided doses based on standard frequencies (e.g. 12h, 24h, rescue doses).\n- Everything must be **purely client-side**, with **no storage of patient data**.\n\n## Project Structure & Tooling\n\n- At the repository root:\n  - Add a concise \`README.md\` describing:\n    - What PalliCalc does.\n    - How to run the frontend.\n    - How to use \`uv\` for the Python logic.\n  - **Initialize git** if not already present:\n    - Run \`git init\` at the repository root.\n    - Create a comprehensive \`.gitignore\` that excludes:\n      - \`node_modules/\`\n      - \`dist/\`, \`build/\`, or other frontend build artifacts.\n      - \`.venv/\`, \`__pycache__/\`, \`*.pyc\`, \`.pytest_cache/\` for Python.\n      - \`.uv/\` or other uv-specific cache directories.\n      - IDE-specific files (\`.vscode/\`, \`.idea/\`, etc.) if appropriate.\n      - OS-specific files (\`.DS_Store\`, \`Thumbs.db\`).\n    - Make an **initial commit** with a clear message like Initial project scaffold for PalliCalc.\n    - After each major milestone (e.g., frontend setup complete, Python core logic implemented, UI complete), make **meaningful commits** with descriptive messages.\n- **Frontend:**\n  - Create a \`frontend/\` directory (or similar) containing the SPA source.\n  - Provide clear \`npm\` or \`pnpm\` scripts for:\n    - \`dev\` (development server),\n    - \`build\` (production build),\n    - \`preview\` or \`serve\` (optional).\n- **Python / uv:**\n  - Under \`ome_core/\` (or similar):\n    - Use \`uv\` to manage dependencies and the environment exclusively (no separate virtualenv).\n    - Clearly document common commands in the repo \`README.md\` and a local \`ome_core/README.md\`, e.g.:\n      - \`uv sync\`\n      - \`uv add\`\n      - \`uv run pytest\`\n\n## Quality & Testing\n\n- Implement unit tests for:\n  - Core OME conversion functions in the Python package (via uv).\n  - At least a few key frontend functions that wrap the calculation logic (using the chosen JS test framework if applicable).\n- Ensure calculations are deterministic and robust against:\n  - High doses (no arbitrary upper limits beyond numeric sanity).\n  - Multiple concurrent drugs.\n  - Edge cases in frequency and asymmetrical dosing.\n\n## Style & Developer Experience\n\n- Prefer **TypeScript** over plain JS in the frontend.\n- Structure code cleanly:\n  - Separate calculation logic from UI components.\n  - Keep drug tables and conversion factors in a dedicated data module.\n- Use clear, self-documenting names and minimal but helpful comments, especially around pharmacological logic and safety rules.\n- Do not add unnecessary external dependencies; keep the stack as lean as possible.\n\n## Your Tasks (High-Level)\n\n1. Read \`PRD.md\` and fully understand the requirements.\n2. Set up:\n   - A React+TypeScript SPA (or similar) in \`frontend/\`.\n   - A uv-managed Python library in \`ome_core/\` implementing and testing the core logic.\n3. Initialize git tracking:\n   - Run \`git init\` if needed.\n   - Create a proper \`.gitignore\`.\n   - Make an initial commit.\n   - Commit regularly at logical milestones with clear, descriptive messages.\n4. Implement the full OME and rotation logic as specified, including all safety and warning behaviors.\n5. Build the mobile-first UI and language toggle exactly as described.\n6. Add minimal, focused tests and documentation.\n7. Ensure the project can be run locally with:\n   - \`npm install\` + \`npm run dev\` (or equivalent) in \`frontend/\`.\n   - \`uv sync\` + \`uv run pytest\` in \`ome_core/\`.\n\nWork autonomously until the project is fully scaffolded and functionally complete according to this description and \`PRD.md\`. Track your progress with git commits at each major step."


claude --dangerously-skip-permissions "You are an autonomous coding agent running inside Cursor with full write access to this repository. Your task is to implement the change request documented in \`prd_changes.md\` while keeping \`PRD.md\` as the canonical source of truth.\n\n## Execution Flow (mandatory)\n\n1. Read project context first:\n   - Read \`PRD.md\` in full.\n   - Inspect the current codebase and relevant docs to understand existing behavior and constraints.\n2. Read \`prd_changes.md\` in full.\n3. Ask clarifying questions before coding:\n   - Use the interactive question tool (AskQuestion) to ask only the necessary questions required to safely implement unclear or conflicting changes.\n   - If no clarification is needed, explicitly state that assumptions are clear and proceed.\n4. Update \`PRD.md\`:\n   - Integrate approved/clarified changes from \`prd_changes.md\` into \`PRD.md\`.\n   - Preserve structure and wording quality; avoid duplications and contradictions.\n5. Implement the changes in code:\n   - Apply all agreed PRD updates across frontend/backend/tests/docs as relevant.\n   - Keep logic consistent with updated PRD.\n   - Add or adjust tests for changed behavior.\n6. Validate locally:\n   - Run relevant tests/build/lint commands.\n   - Fix issues introduced by the changes.\n7. Publish to GitHub:\n   - Create clear, meaningful commit(s).\n   - Push the branch to GitHub (set upstream if needed).\n   - If workflow uses PRs, open a PR with a concise summary and test notes.\n\n## Quality Bar\n\n- Do not skip ambiguity handling: ask questions when needed.\n- Do not leave PRD and implementation out of sync.\n- Keep changes minimal-but-complete, production-quality, and consistent with existing project conventions.\n- Provide a final report listing: clarified questions/answers, PRD sections updated, files changed, tests run, and GitHub link(s)." 


claude --dangerously-skip-permissions "the current state of the project is not satisfactory. I want to reimplement it fully. Your job is to create the ultimate_PRD.md for the next reimplementation. the ground truth is the user_requirements.md file. check the current and the previous version of the code and the prd documents and keep the working concepts that satisfied the user and discard the ones that did not. Create an agent team for this task. One agent solely responsible for the clinical part meaning the opioid names, conversion and doses and other clinical aspects of the website. The second agent should be responsible for the frontend. The third agent should be responsible for knowing what went wrong in the previous versions and the users exact requests and make sure that the new implementation satisfies the user requirements. feel free to create more md files if needed. just dont code yet. also create a plan for the implementation based on the ultimate_PRD.md. just create the plan. dont code yet."


claude --dangerously-skip-permissions "You are an autonomous coding agent running inside Cursor with full write access to this repository. Your task is to integrate the clinical safety changes below with minimal, low-risk edits, preserving all existing functionality unless explicitly changed.

## Goal and constraints
- Prioritize patient safety and correctness.
- Keep changes as small as possible (minimal diff), avoid refactors unless strictly needed.
- Do not break existing calculation flows, UI behavior, translations, or tests outside the requested scope.
- Before editing, identify affected modules/files and produce a short change plan.
- If any requirement is ambiguous or conflicts with existing behavior, ask clarifying questions first.

## Required product changes
1) Remove breakthrough pain functionality entirely:
   - Remove all `áttörési fájdalom` related logic, UI controls, calculations, outputs, and tests.
   - Ensure no dead references remain.

2) Tramadol maximum daily dose:
   - Enforce hard limit: 400 mg/day.
   - If user input exceeds this, show warning text exactly:
     \"400 mg tramadol hidrokloridnak megfelelő teljes napi adagokat nem szabad túllépni\".

3) DHC maximum daily dose:
   - Enforce hard limit: 240 mg/day.
   - For higher input, show warning that above this level there is insufficient clinical experience, and include this lethality warning:
     5 mg/ttkg dózis már letális lehet.

4) Methadone rotation restriction:
   - Do not allow rotation to methadone by default.
   - Allow only when EMO is exactly 10 mg.
   - Whenever methadone is involved, always show this warning text:
     A metadon felezési ideje hosszú, ezért akkumulálódhat. Egyetlen, a tüneteket enyhítő dózis naponta történő ismétlődő bevétele akkumulációhoz és halálhoz vezethet!

5) Oral hydromorphone rotation hydration warning:
   - When rotating to oral hydromorphone, show warning that rotation is recommended only in well-hydrated patients and remind about adequate daily fluid intake.

6) Minor opioid rotation guard:
   - Do not allow rotation to a minor opioid unless current major opioid dose is below the selected minor opioid maximum dose.

## Implementation quality
- Update logic, UI messaging, validation, and tests together.
- Keep warning texts clinically accurate and consistent across HU/EN layers (if multilingual, preserve existing i18n conventions).
- Run build/lint/tests and fix regressions introduced by these changes.

## Git workflow
- Create clear commit(s) describing safety-rule updates.
- Push branch to remote (set upstream if needed).
- Return a concise report with:
  - files changed
  - rules implemented
  - tests/build commands run and results
  - commit hash(es) and remote link(s)." 